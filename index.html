<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .form-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5rem;
            font-weight: 500;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            font-size: 0.8rem;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .btn-edit {
            background: #28a745;
            color: white;
            padding: 8px 15px;
            font-size: 0.8rem;
            margin-right: 5px;
        }

        .btn-edit:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .search-section {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .search-box {
            position: relative;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .employee-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .employee-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .employee-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .employee-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 15px;
        }

        .employee-info h3 {
            color: #333;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .employee-info .position {
            color: #667eea;
            font-weight: 500;
        }

        .employee-details {
            margin-bottom: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-label {
            color: #666;
            font-weight: 500;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .employee-actions {
            display: flex;
            gap: 10px;
        }

        .stats-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            color: #667eea;
            margin-bottom: 25px;
            text-align: center;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #667eea;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .employee-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Employee Management System</h1>
            <p>Streamline your workforce management with our comprehensive CRUD application</p>
        </div>

        <div class="main-content">
            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalEmployees">0</div>
                        <div class="stat-label">Total Employees</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeDepartments">0</div>
                        <div class="stat-label">Departments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageSalary">$0</div>
                        <div class="stat-label">Avg Salary</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="newestEmployee">-</div>
                        <div class="stat-label">Newest Hire</div>
                    </div>
                </div>
            </div>

            <!-- Add Employee Form -->
            <div class="form-section">
                <h2>Add New Employee</h2>
                <div id="alert-container"></div>
                <form id="employeeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone</label>
                            <input type="tel" id="phone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="position">Position *</label>
                            <input type="text" id="position" name="position" required>
                        </div>
                        <div class="form-group">
                            <label for="department">Department *</label>
                            <select id="department" name="department" required>
                                <option value="">Select Department</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Sales">Sales</option>
                                <option value="HR">Human Resources</option>
                                <option value="Finance">Finance</option>
                                <option value="Operations">Operations</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="salary">Salary *</label>
                            <input type="number" id="salary" name="salary" min="0" step="1000" required>
                        </div>
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">Add Employee</button>
                        <button type="button" class="btn btn-secondary" id="cancelBtn" style="display: none;">Cancel Edit</button>
                    </div>
                </form>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search employees by name, position, or department...">
                    <span class="search-icon">🔍</span>
                </div>
            </div>

            <!-- Employees List -->
            <div class="form-section">
                <h2>Employee Directory</h2>
                <div id="employeeList" class="employee-grid">
                    <div class="empty-state">
                        <h3>No Employees Yet</h3>
                        <p>Add your first employee using the form above to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Employee</h2>
            <div id="modal-alert-container"></div>
            <form id="editEmployeeForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editFirstName">First Name *</label>
                        <input type="text" id="editFirstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="editLastName">Last Name *</label>
                        <input type="text" id="editLastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email *</label>
                        <input type="email" id="editEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="editPhone">Phone</label>
                        <input type="tel" id="editPhone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="editPosition">Position *</label>
                        <input type="text" id="editPosition" name="position" required>
                    </div>
                    <div class="form-group">
                        <label for="editDepartment">Department *</label>
                        <select id="editDepartment" name="department" required>
                            <option value="">Select Department</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Sales">Sales</option>
                            <option value="HR">Human Resources</option>
                            <option value="Finance">Finance</option>
                            <option value="Operations">Operations</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editSalary">Salary *</label>
                        <input type="number" id="editSalary" name="salary" min="0" step="1000" required>
                    </div>
                    <div class="form-group">
                        <label for="editStartDate">Start Date *</label>
                        <input type="date" id="editStartDate" name="startDate" required>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary">Update Employee</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class ErrorBoundary {
            static handleError(error, context) {
                console.error(`Error in ${context}:`, error);
                this.showAlert(`An error occurred while ${context}. Please try again.`, 'error');
            }
        }

        class EmployeeManager {
            constructor() {
                this.employees = [];
                this.filteredEmployees = [];
                this.debounceTimeout = null;
                this.initializeEventListeners();
                this.loadEmployees();
            }

            async loadEmployees() {
                try {
                    const response = await fetch('http://localhost:3000/employees');
                    const data = await response.json();
                    this.employees = data;
                    this.renderEmployees();
                    this.updateStats();
                } catch (error) {
                    console.error('Error loading employees:', error);
                    this.showAlert('Failed to load employees. Please try again.', 'error');
                }
            }

            async saveEmployees() {
                try {
                    await fetch('http://localhost:3000/employees', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.employees)
                    });
                } catch (error) {
                    console.error('Error saving employees:', error);
                    this.showAlert('Failed to save changes. Please try again.', 'error');
                }
            }

            loadSampleData() {
                if (this.employees.length === 0) {
                    // Add some sample employees for demonstration
                    const sampleEmployees = [
                        {
                            id: this.generateId(),
                            firstName: 'John',
                            lastName: 'Doe',
                            email: 'john.doe@company.com',
                            phone: '+1-555-0123',
                            position: 'Senior Developer',
                            department: 'Engineering',
                            salary: 85000,
                            startDate: '2023-01-15'
                        },
                        {
                            id: this.generateId(),
                            firstName: 'Sarah',
                            lastName: 'Johnson',
                            email: 'sarah.johnson@company.com',
                            phone: '+1-555-0124',
                            position: 'Marketing Manager',
                            department: 'Marketing',
                            salary: 75000,
                            startDate: '2023-03-10'
                        },
                        {
                            id: this.generateId(),
                            firstName: 'Michael',
                            lastName: 'Chen',
                            email: 'michael.chen@company.com',
                            phone: '+1-555-0125',
                            position: 'Sales Representative',
                            department: 'Sales',
                            salary: 60000,
                            startDate: '2023-06-01'
                        }
                    ];
                    
                    this.employees = sampleEmployees;
                    this.renderEmployees();
                    this.updateStats();
                }
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            initializeEventListeners() {
                // Form submission
                document.getElementById('employeeForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleFormSubmit();
                });

                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.handleSearch(e.target.value);
                });

                // Edit modal
                const modal = document.getElementById('editModal');
                const closeBtn = document.querySelector('.close');
                
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });

                window.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });

                // Edit form submission
                document.getElementById('editEmployeeForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleEditSubmit();
                });

                // Cancel edit button
                document.getElementById('cancelBtn').addEventListener('click', () => {
                    this.cancelEdit();
                });
            }

            sanitizeInput(input) {
                return input.replace(/[<>]/g, '').trim();
            }

            async handleFormSubmit() {
                try {
                    const formData = new FormData(document.getElementById('employeeForm'));
                    const employeeData = Object.fromEntries(formData.entries());
                    
                    // Sanitize inputs
                    Object.keys(employeeData).forEach(key => {
                        if (typeof employeeData[key] === 'string') {
                            employeeData[key] = this.sanitizeInput(employeeData[key]);
                        }
                    });

                    // Validation
                    if (!this.validateEmployee(employeeData)) {
                        return;
                    }

                    if (this.currentEditId) {
                        // Update existing employee
                        const index = this.employees.findIndex(emp => emp.id === this.currentEditId);
                        if (index !== -1) {
                            this.employees[index] = { ...employeeData, id: this.currentEditId };
                            this.showAlert('Employee updated successfully!', 'success');
                            this.cancelEdit();
                        }
                    } else {
                        // Add new employee
                        const newEmployee = {
                            id: this.generateId(),
                            ...employeeData
                        };
                        this.employees.push(newEmployee);
                        this.showAlert('Employee added successfully!', 'success');
                        document.getElementById('employeeForm').reset();
                    }

                    this.saveEmployees();
                    this.renderEmployees();
                    this.updateStats();
                } catch (error) {
                    ErrorBoundary.handleError(error, 'submitting form');
                }
            }

            validateEmployee(data) {
                const requiredFields = ['firstName', 'lastName', 'email', 'position', 'department', 'salary', 'startDate'];
                
                for (let field of requiredFields) {
                    if (!data[field] || data[field].trim() === '') {
                        this.showAlert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field.`, 'error');
                        return false;
                    }
                }

                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(data.email)) {
                    this.showAlert('Please enter a valid email address.', 'error');
                    return false;
                }

                // Check for duplicate email (excluding current edit)
                const existingEmployee = this.employees.find(emp => 
                    emp.email.toLowerCase() === data.email.toLowerCase() && 
                    emp.id !== this.currentEditId
                );
                
                if (existingEmployee) {
                    this.showAlert('An employee with this email already exists.', 'error');
                    return false;
                }

                // Salary validation
                if (isNaN(data.salary) || parseFloat(data.salary) < 0) {
                    this.showAlert('Please enter a valid salary amount.', 'error');
                    return false;
                }

                // Add phone number validation
                if (data.phone) {
                    const phoneRegex = /^\+?[\d\s-]{10,}$/;
                    if (!phoneRegex.test(data.phone)) {
                        this.showAlert('Please enter a valid phone number.', 'error');
                        return false;
                    }
                }

                // Add date validation
                const startDate = new Date(data.startDate);
                const today = new Date();
                if (startDate > today) {
                    this.showAlert('Start date cannot be in the future.', 'error');
                    return false;
                }

                // Add salary range validation
                const minSalary = 20000; // Example minimum salary
                const maxSalary = 500000; // Example maximum salary
                if (data.salary < minSalary || data.salary > maxSalary) {
                    this.showAlert(`Salary must be between $${minSalary.toLocaleString()} and $${maxSalary.toLocaleString()}.`, 'error');
                    return false;
                }

                return true;
            }

            showAlert(message, type, container = 'alert-container') {
                const alertContainer = document.getElementById(container);
                const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
                
                alertContainer.innerHTML = `
                    <div class="alert ${alertClass}">
                        ${message}
                    </div>
                `;

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    alertContainer.innerHTML = '';
                }, 5000);
            }

            renderEmployees(employeesToRender = this.employees) {
                const container = document.getElementById('employeeList');
                
                if (employeesToRender.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No Employees Found</h3>
                            <p>Add your first employee using the form above to get started!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = employeesToRender.map(employee => `
                    <div class="employee-card">
                        <div class="employee-header">
                            <div class="employee-avatar">
                                ${employee.firstName.charAt(0).toUpperCase()}${employee.lastName.charAt(0).toUpperCase()}
                            </div>
                            <div class="employee-info">
                                <h3>${employee.firstName} ${employee.lastName}</h3>
                                <div class="position">${employee.position}</div>
                            </div>
                        </div>
                        <div class="employee-details">
                            <div class="detail-row">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value">${employee.email}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Phone:</span>
                                <span class="detail-value">${employee.phone || 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Department:</span>
                                <span class="detail-value">${employee.department}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Salary:</span>
                                <span class="detail-value">$${parseInt(employee.salary).toLocaleString()}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Start Date:</span>
                                <span class="detail-value">${new Date(employee.startDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="employee-actions">
                            <button class="btn btn-edit" onclick="employeeManager.editEmployee('${employee.id}')">
                                Edit
                            </button>
                            <button class="btn btn-danger" onclick="employeeManager.deleteEmployee('${employee.id}')">
                                Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            editEmployee(id) {
                const employee = this.employees.find(emp => emp.id === id);
                if (!employee) return;

                this.currentEditId = id;
                
                // Fill edit form
                document.getElementById('editFirstName').value = employee.firstName;
                document.getElementById('editLastName').value = employee.lastName;
                document.getElementById('editEmail').value = employee.email;
                document.getElementById('editPhone').value = employee.phone || '';
                document.getElementById('editPosition').value = employee.position;
                document.getElementById('editDepartment').value = employee.department;
                document.getElementById('editSalary').value = employee.salary;
                document.getElementById('editStartDate').value = employee.startDate;

                // Show modal
                document.getElementById('editModal').style.display = 'block';
            }

            handleEditSubmit() {
                const formData = new FormData(document.getElementById('editEmployeeForm'));
                const employeeData = Object.fromEntries(formData.entries());

                // Validation
                if (!this.validateEmployeeEdit(employeeData)) {
                    return;
                }

                // Update employee
                const index = this.employees.findIndex(emp => emp.id === this.currentEditId);
                if (index !== -1) {
                    this.employees[index] = { ...employeeData, id: this.currentEditId };
                    this.showAlert('Employee updated successfully!', 'success');
                    document.getElementById('editModal').style.display = 'none';
                    this.currentEditId = null;
                    this.saveEmployees();
                    this.renderEmployees();
                    this.updateStats();
                }
            }

            validateEmployeeEdit(data) {
                const requiredFields = ['firstName', 'lastName', 'email', 'position', 'department', 'salary', 'startDate'];
                
                for (let field of requiredFields) {
                    if (!data[field] || data[field].trim() === '') {
                                    this.showAlert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field.`, 'error', 'modal-alert-container');
                                    return false;
                                }
                            }
            
                            // Email validation
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (!emailRegex.test(data.email)) {
                                this.showAlert('Please enter a valid email address.', 'error', 'modal-alert-container');
                                return false;
                            }
            
                            // Check for duplicate email (excluding current edit)
                            const existingEmployee = this.employees.find(emp => 
                                emp.email.toLowerCase() === data.email.toLowerCase() && 
                                emp.id !== this.currentEditId
                            );
                            
                            if (existingEmployee) {
                                this.showAlert('An employee with this email already exists.', 'error', 'modal-alert-container');
                                return false;
                            }
            
                            // Salary validation
                            if (isNaN(data.salary) || parseFloat(data.salary) < 0) {
                                this.showAlert('Please enter a valid salary amount.', 'error', 'modal-alert-container');
                                return false;
                            }
            
                            return true;
            }
            deleteEmployee(id) {
                if (confirm('Are you sure you want to delete this employee?')) {
                    this.employees = this.employees.filter(emp => emp.id !== id);
                    this.showAlert('Employee deleted successfully!', 'success');
                    this.saveEmployees();
                    this.renderEmployees();
                    this.updateStats();
                }
            }

            // Debounced search
            handleSearch(query) {
                clearTimeout(this.debounceTimeout);
                this.debounceTimeout = setTimeout(() => {
                    this.performSearch(query);
                }, 300);
            }

            performSearch(query) {
                if (!query.trim()) {
                    this.renderEmployees();
                    return;
                }

                const searchQuery = query.toLowerCase().trim();
                const filteredEmployees = this.employees.filter(emp => {
                    return (
                        emp.firstName.toLowerCase().includes(searchQuery) ||
                        emp.lastName.toLowerCase().includes(searchQuery) ||
                        emp.position.toLowerCase().includes(searchQuery) ||
                        emp.department.toLowerCase().includes(searchQuery) ||
                        emp.email.toLowerCase().includes(searchQuery)
                    );
                });

                this.renderEmployees(filteredEmployees);
                
                if (filteredEmployees.length === 0) {
                    this.showAlert('No employees found matching your search.', 'error');
                }
            }

            updateStats() {
                const stats = {
                    totalEmployees: this.employees.length,
                    activeDepartments: new Set(this.employees.map(emp => emp.department)).size,
                    averageSalary: this.employees.reduce((acc, emp) => acc + Number(emp.salary), 0) / this.employees.length || 0,
                    newestEmployee: this.employees.reduce((newest, emp) => {
                        return new Date(emp.startDate) > new Date(newest.startDate) ? emp : newest;
                    }, this.employees[0])
                };

                document.getElementById('totalEmployees').textContent = stats.totalEmployees;
                document.getElementById('activeDepartments').textContent = stats.activeDepartments;
                document.getElementById('averageSalary').textContent = stats.averageSalary ? 
                    `$${Math.round(stats.averageSalary).toLocaleString()}` : '$0';
                document.getElementById('newestEmployee').textContent = stats.newestEmployee ? 
                    `${stats.newestEmployee.firstName} ${stats.newestEmployee.lastName}` : '-';
            }
        }

        const employeeManager = new EmployeeManager();

        // Expose global functions for inline event handlers
        function editEmployee(id) {
            employeeManager.editEmployee(id);
        }

        function deleteEmployee(id) {
            employeeManager.deleteEmployee(id);
        }
    </script>
</body>
</html>